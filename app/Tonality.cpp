#include "Tonality.h"
#include "ScreenBuffer.h"
#include "MusicTypes.h"

namespace MusicReadingTrainer {

    std::vector<std::wstring> C_major = {
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
    };

    std::vector<std::wstring> G_major = {

        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"#------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
    };


    std::vector<std::wstring> D_major = {

        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"#------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L" #                 |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
    };

    std::vector<std::wstring> A_major = {

        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"  #                |                                                                                           ",
        L"#------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L" #                 |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
    };

    std::vector<std::wstring> E_major = {

        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"  #                |                                                                                           ",
        L"#------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"---#---------------|-------------------------------------------------------------------------------------------",
        L" #                 |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
    };

    std::vector<std::wstring> B_major = {

        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"  #                |                                                                                           ",
        L"#------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"---#---------------|-------------------------------------------------------------------------------------------",
        L" #                 |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"    #              |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
    };


    std::vector<std::wstring> Gflat_major = {

        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L" b                 |                                                                                           ",
        L"---b---------------|-------------------------------------------------------------------------------------------",
        L"     b             |                                                                                           ",
        L"b------------------|-------------------------------------------------------------------------------------------",
        L"  b                |                                                                                           ",
        L"----b--------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
    };


    std::vector<std::wstring> Dflat_major = {

        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L" b                 |                                                                                           ",
        L"---b---------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"b------------------|-------------------------------------------------------------------------------------------",
        L"  b                |                                                                                           ",
        L"----b--------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
    };

    std::vector<std::wstring> Aflat_major = {

        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L" b                 |                                                                                           ",
        L"---b---------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"b------------------|-------------------------------------------------------------------------------------------",
        L"  b                |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
    };

    std::vector<std::wstring> Eflat_major = {

        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L" b                 |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"b------------------|-------------------------------------------------------------------------------------------",
        L"  b                |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
    };


    std::vector<std::wstring> Bflat_major = {

        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L" b                 |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"b------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
    };

    std::vector<std::wstring> F_major = {

        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"b------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"-------------------|-------------------------------------------------------------------------------------------",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
        L"                   |                                                                                           ",
    };

    void Tonality::initializeStaves() {

        staves = {

            { Key::C, C_major },
            { Key::G, G_major },
            { Key::D, D_major },
            { Key::A, A_major },
            { Key::E, E_major },
            { Key::B, B_major },
            { Key::Gflat, Gflat_major },
            { Key::Dflat, Dflat_major },
            { Key::Aflat, Aflat_major },
            { Key::Eflat, Eflat_major },
            { Key::Bflat, Bflat_major },
            { Key::F, F_major },

        };

    }

    void Tonality::initializeNotePositions() {

        notePositions[Key::C] = {
            { NoteName::C,  {2, 9, 16} },
            { NoteName::D,  {8, 15} },
            { NoteName::E,  {7, 14} },
            { NoteName::F,  {6, 13} },
            { NoteName::G,  {5, 12} },
            { NoteName::A,  {4, 11, 18} },
            { NoteName::B,  {3, 10, 17} }
        };

        notePositions[Key::G] = {
            { NoteName::C,      {2, 9, 16} },
            { NoteName::D,      {8, 15} },
            { NoteName::E,      {7, 14} },
            { NoteName::Fsharp, {6, 13} },
            { NoteName::G,      {5, 12} },
            { NoteName::A,      {4, 11, 18} },
            { NoteName::B,      {3, 10, 17} }
        };

        notePositions[Key::D] = {
            { NoteName::Csharp, {2, 9, 16} },
            { NoteName::D,      {8, 15} },
            { NoteName::E,      {7, 14} },
            { NoteName::Fsharp, {6, 13} },
            { NoteName::G,      {5, 12} },
            { NoteName::A,      {4, 11, 18} },
            { NoteName::B,      {3, 10, 17} }
        };

        notePositions[Key::A] = {
            { NoteName::Csharp, {2, 9, 16} },
            { NoteName::D,      {8, 15} },
            { NoteName::E,      {7, 14} },
            { NoteName::Fsharp, {6, 13} },
            { NoteName::Gsharp, {5, 12} },
            { NoteName::A,      {4, 11, 18} },
            { NoteName::B,      {3, 10, 17} }
        };

        notePositions[Key::E] = {
            { NoteName::Csharp, {2, 9, 16} },
            { NoteName::Dsharp, {8, 15} },
            { NoteName::E,      {7, 14} },
            { NoteName::Fsharp, {6, 13} },
            { NoteName::Gsharp, {5, 12} },
            { NoteName::A,      {4, 11, 18} },
            { NoteName::B,      {3, 10, 17} }
        };

        notePositions[Key::B] = {
            { NoteName::Csharp, {2, 9, 16} },
            { NoteName::Dsharp, {8, 15} },
            { NoteName::E,      {7, 14} },
            { NoteName::Fsharp, {6, 13} },
            { NoteName::Gsharp, {5, 12} },
            { NoteName::Asharp, {4, 11, 18} },
            { NoteName::B,      {3, 10, 17} }
        };

        notePositions[Key::Gflat] = {
            { NoteName::B,  {2, 9, 16} },
            { NoteName::Dflat,  {8, 15} },
            { NoteName::Eflat,  {7, 14} },
            { NoteName::F,      {6, 13} },
            { NoteName::Gflat,  {5, 12} },
            { NoteName::Aflat,  {4, 11, 18} },
            { NoteName::Bflat,  {3, 10, 17} }
        };

        notePositions[Key::Dflat] = {
            { NoteName::C,      {2, 9, 16} },
            { NoteName::Dflat,  {8, 15} },
            { NoteName::Eflat,  {7, 14} },
            { NoteName::F,      {6, 13} },
            { NoteName::Gflat,  {5, 12} },
            { NoteName::Aflat,  {4, 11, 18} },
            { NoteName::Bflat,  {3, 10, 17} }
        };

        notePositions[Key::Aflat] = {
            { NoteName::C,      {2, 9, 16} },
            { NoteName::Dflat,  {8, 15} },
            { NoteName::Eflat,  {7, 14} },
            { NoteName::F,      {6, 13} },
            { NoteName::G,      {5, 12} },
            { NoteName::Aflat,  {4, 11, 18} },
            { NoteName::Bflat,  {3, 10, 17} }
        };

        notePositions[Key::Eflat] = {
            { NoteName::C,      {2, 9, 16} },
            { NoteName::D,      {8, 15} },
            { NoteName::Eflat,  {7, 14} },
            { NoteName::F,      {6, 13} },
            { NoteName::G,      {5, 12} },
            { NoteName::Aflat,  {4, 11, 18} },
            { NoteName::Bflat,  {3, 10, 17} }
        };

        notePositions[Key::Bflat] = {
            { NoteName::C,      {2, 9, 16} },
            { NoteName::D,      {8, 15} },
            { NoteName::Eflat,  {7, 14} },
            { NoteName::F,      {6, 13} },
            { NoteName::G,      {5, 12} },
            { NoteName::A,      {4, 11, 18} },
            { NoteName::Bflat,  {3, 10, 17} }
        };

        notePositions[Key::F] = {
            { NoteName::C,      {2, 9, 16} },
            { NoteName::D,      {8, 15} },
            { NoteName::E,      {7, 14} },
            { NoteName::F,      {6, 13} },
            { NoteName::G,      {5, 12} },
            { NoteName::A,      {4, 11, 18} },
            { NoteName::Bflat,  {3, 10, 17} }
        };
    }

    Tonality::Tonality() {

        initializeStaves();
        initializeNotePositions();

    }

    void Tonality::draw(ScreenBuffer& screenBuffer, Key key) {

        const std::vector<std::wstring>& data = staves[key];

        screenBuffer.setScreen(position_x, position_y, data);

    }

    const std::map<NoteName, std::vector<int>>& Tonality::getNotePositionsForKey(Key key) const {
        return notePositions.at(key);
    }

    bool Tonality::isFlatKey(Key key) const {

        static const std::vector<Key> sharpKeys = {
            Key::C, Key::G, Key::D, Key::A, Key::E, Key::B, Key::F
        };

        return std::find(sharpKeys.begin(), sharpKeys.end(), key) == sharpKeys.end();
    }

}